<!-- templates/components/sidebar.html -->
<!-- Sidebar Reutilizable para todo el sistema -->
<aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <a href="/" class="sidebar-brand">
            <!-- Logo desde la carpeta static -->
            <img src="/static/img/LOGO-1.PNG" alt="Logo de RoyDent" class="sidebar-logo-img" id="sidebarLogo" onerror="handleLogoError()">
            <!-- Logo por defecto (oculto inicialmente) -->
            <div class="logo-default" id="defaultLogo" style="display: none;">
                ROY
            </div>
            <div>
                <div class="sidebar-title">Sistema RoyDent</div>
                <div class="sidebar-subtitle">Y Mundo Medico</div>
            </div>
        </a>
    </div>
    
    <nav class="sidebar-nav">
        <div class="nav-section">
            <div class="nav-title">Principal</div>
            <div class="nav-item">
                <a href="/panel-admin/" class="nav-link" data-page="dashboard">
                    <div class="nav-icon">🏠</div>
                    Dashboard
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-page="analytics">
                    <div class="nav-icon">📊</div>
                    Analíticas
                </a>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-title">Productos</div>
            <div class="nav-item">
                <a href="/agregar-producto/" class="nav-link" data-page="add-product">
                    <div class="nav-icon">➕</div>
                    Agregar Producto
                </a>
            </div>
            <div class="nav-item">
                <a href="/productos/" class="nav-link" data-page="products">
                    <div class="nav-icon">📦</div>
                    Lista de Productos
                </a>
            </div>
            <div class="nav-item">
                <a href="/categorias/" class="nav-link" data-page="categories">
                    <div class="nav-icon">🏷️</div>
                    Categorías
                </a>
            </div>
            <div class="nav-item">
                <a href="/control-fifo/" class="nav-link" data-page="fifo">
                    <div class="nav-icon">🔄</div>
                    Control FIFO
                </a>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-title">Inventario</div>
            <div class="nav-item">
                <a href="/inventario/" class="nav-link" data-page="inventory">
                    <div class="nav-icon">📋</div>
                    Inventario General
                </a>
            </div>
            <div class="nav-item">
                <a href="/stock-bajo/" class="nav-link" data-page="low-stock">
                    <div class="nav-icon">⚠️</div>
                    Stock Bajo
                </a>
            </div>
            <div class="nav-item">
                <a href="/ubicaciones/" class="nav-link" data-page="locations">
                    <div class="nav-icon">📍</div>
                    Ubicaciones
                </a>
            </div>
            <div class="nav-item">
                <a href="/proveedores/" class="nav-link" data-page="suppliers">
                    <div class="nav-icon">👨‍💼</div>
                    Proveedores
                </a>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-title">Ventas</div>
            <div class="nav-item">
                <a href="/nueva-venta/" class="nav-link" data-page="new-sale">
                    <div class="nav-icon">🛒</div>
                    Nueva Venta
                </a>
            </div>
            <div class="nav-item">
                <a href="/historial-ventas/" class="nav-link" data-page="sales-history">
                    <div class="nav-icon">💰</div>
                    Historial Ventas
                </a>
            </div>
            <div class="nav-item">
                <a href="/clientes/" class="nav-link" data-page="clients">
                    <div class="nav-icon">👥</div>
                    Clientes
                </a>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-title">Reportes</div>
            <div class="nav-item">
                <a href="/reportes-ventas/" class="nav-link" data-page="sales-reports">
                    <div class="nav-icon">📈</div>
                    Reportes de Ventas
                </a>
            </div>
            <div class="nav-item">
                <a href="/analisis-inventario/" class="nav-link" data-page="inventory-analysis">
                    <div class="nav-icon">📉</div>
                    Análisis de Inventario
                </a>
            </div>
            <div class="nav-item">
                <a href="/reportes-financieros/" class="nav-link" data-page="financial-reports">
                    <div class="nav-icon">💼</div>
                    Reportes Financieros
                </a>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-title">Configuración</div>
            <div class="nav-item">
                <a href="/configuracion/" class="nav-link" data-page="settings">
                    <div class="nav-icon">⚙️</div>
                    Configuración
                </a>
            </div>
            <div class="nav-item">
                <a href="/perfil/" class="nav-link" data-page="profile">
                    <div class="nav-icon">👤</div>
                    Perfil
                </a>
            </div>
            <div class="nav-item">
                <a href="/usuarios/" class="nav-link" data-page="users">
                    <div class="nav-icon">👥</div>
                    Usuarios
                </a>
            </div>
            <div class="nav-item">
                <a href="/backups/" class="nav-link" data-page="backups">
                    <div class="nav-icon">💾</div>
                    Backup
                </a>
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-item">
                <a href="/auth/logout/" class="nav-link" data-page="logout">
                    <div class="nav-icon">🚪</div>
                    Cerrar Sesión
                </a>
            </div>
        </div>
    </nav>
</aside>

<!-- Mobile Header -->
<header class="mobile-header" id="mobile-header">
    <button class="mobile-menu-btn" onclick="toggleSidebar()">☰</button>
    <img src="/static/img/LOGO-1.PNG" alt="Logo de RoyDent" class="mobile-logo" id="mobileLogo" onerror="handleMobileLogoError()">
</header>

<!-- Sidebar Overlay -->
<div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

<script>
// ============ MANEJO DE LOGOS ============
function handleLogoError() {
    const sidebarLogo = document.getElementById('sidebarLogo');
    const defaultLogo = document.getElementById('defaultLogo');
    if (sidebarLogo) sidebarLogo.style.display = 'none';
    if (defaultLogo) defaultLogo.style.display = 'flex';
}

function handleMobileLogoError() {
    const mobileLogo = document.getElementById('mobileLogo');
    if (mobileLogo) {
        mobileLogo.src = '';
        mobileLogo.alt = 'Sistema Roy';
        mobileLogo.style.fontFamily = 'Inter, sans-serif';
        mobileLogo.style.fontWeight = '700';
        mobileLogo.style.fontSize = '1.2rem';
        mobileLogo.style.color = 'var(--color-green-dark)';
    }
}

// ============ FUNCIONES DEL SIDEBAR ============
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    
    if (sidebar) sidebar.classList.toggle('active');
    if (overlay) overlay.classList.toggle('active');
}

// ============ MARCAR PÁGINA ACTIVA ============
function marcarPaginaActiva() {
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.nav-link');
    
    navLinks.forEach(link => {
        link.classList.remove('active');
        const href = link.getAttribute('href');
        
        if (href === currentPath || currentPath.includes(href)) {
            link.classList.add('active');
        }
    });
}

// Ejecutar al cargar la página
document.addEventListener('DOMContentLoaded', function() {
    marcarPaginaActiva();
    
    // Verificar logos
    const sidebarLogo = document.getElementById('sidebarLogo');
    const mobileLogo = document.getElementById('mobileLogo');
    
    if (sidebarLogo && (sidebarLogo.complete && sidebarLogo.naturalHeight === 0)) {
        handleLogoError();
    }
    
    if (mobileLogo && (mobileLogo.complete && mobileLogo.naturalHeight === 0)) {
        handleMobileLogoError();
    }
    
    setTimeout(function() {
        if (sidebarLogo && (sidebarLogo.complete && sidebarLogo.naturalHeight === 0)) {
            handleLogoError();
        }
        if (mobileLogo && (mobileLogo.complete && mobileLogo.naturalHeight === 0)) {
            handleMobileLogoError();
        }
    }, 1000);
});
</script>